{"version":3,"sources":["reactComponent.ts"],"names":[],"mappings":"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","file":"reactComponent.js","sourcesContent":["import * as React from 'react';\nimport {ReactPortal} from 'react';\nimport * as ReactDOM from 'react-dom';\nimport {ComponentType, Promise, Utils} from '@ag-grid-community/core';\nimport {AgGridReact} from \"./agGridReact\";\nimport {BaseReactComponent} from \"./baseReactComponent\";\nimport {assignProperties} from \"./utils\";\nimport generateNewKey from \"./keyGenerator\";\nimport {renderToStaticMarkup} from \"react-dom/server\";\n\nexport class ReactComponent extends BaseReactComponent {\n    static REACT_MEMO_TYPE = ReactComponent.hasSymbol() ? Symbol.for('react.memo') : 0xead3;\n\n    private eParentElement!: HTMLElement;\n    private componentInstance: any;\n\n    private reactComponent: any;\n    private componentType: ComponentType;\n    private parentComponent: AgGridReact;\n    private portal: ReactPortal | null = null;\n    private componentWrappingElement: string = 'div';\n    private statelessComponent: boolean;\n    private staticMarkup: HTMLElement | null | string = null;\n\n    constructor(reactComponent: any,\n                parentComponent: AgGridReact,\n                componentType: ComponentType) {\n        super();\n\n        this.reactComponent = reactComponent;\n        this.componentType = componentType;\n        this.parentComponent = parentComponent;\n        this.statelessComponent = ReactComponent.isStateless(this.reactComponent);\n    }\n\n    public getFrameworkComponentInstance(): any {\n        return this.componentInstance;\n    }\n\n    public isStatelessComponent(): boolean {\n        return this.statelessComponent;\n    }\n\n    public getReactComponentName(): string {\n        return this.reactComponent.name;\n    }\n\n    public init(params: any): Promise<void> {\n        this.eParentElement = this.createParentElement(params);\n\n        this.renderStaticMarkup(params);\n\n        return new Promise<void>((resolve: any) => {\n            this.createReactComponent(params, resolve);\n        });\n    }\n\n    public getGui(): HTMLElement {\n        return this.eParentElement;\n    }\n\n    public destroy(): void {\n        return this.parentComponent.destroyPortal(this.portal as ReactPortal);\n    }\n\n    private createReactComponent(params: any, resolve: (value: any) => void) {\n        if (!this.statelessComponent) {\n            // grab hold of the actual instance created\n            params.ref = (element: any) => {\n                this.componentInstance = element;\n\n                this.addParentContainerStyleAndClasses();\n\n                // regular components (ie not functional)\n                this.removeStaticMarkup();\n            };\n        }\n\n        const reactComponent = React.createElement(this.reactComponent, params);\n        const portal: ReactPortal = ReactDOM.createPortal(\n            reactComponent,\n            this.eParentElement as any,\n            generateNewKey() // fixed deltaRowModeRefreshCompRenderer\n        );\n        this.portal = portal;\n        this.parentComponent.mountReactPortal(portal!, this, (value: any) => {\n            resolve(value);\n\n            // functional/stateless components have a slightly different lifecycle (no refs) so we'll clean them up\n            // here\n            if(this.statelessComponent) {\n                setTimeout(() => {\n                    this.removeStaticMarkup();\n                })\n            }\n        });\n    }\n\n    private addParentContainerStyleAndClasses() {\n        if (!this.componentInstance) {\n            return;\n        }\n\n        if (this.componentInstance.getReactContainerStyle && this.componentInstance.getReactContainerStyle()) {\n            assignProperties(this.eParentElement.style, this.componentInstance.getReactContainerStyle())\n        }\n        if (this.componentInstance.getReactContainerClasses && this.componentInstance.getReactContainerClasses()) {\n            const parentContainerClasses: string[] = this.componentInstance.getReactContainerClasses();\n            parentContainerClasses.forEach(className => Utils.addCssClass(this.eParentElement as HTMLElement, className));\n        }\n    }\n\n    private createParentElement(params: any) {\n        const eParentElement = document.createElement(this.parentComponent.props.componentWrappingElement || 'div');\n\n        Utils.addCssClass(eParentElement as HTMLElement, 'ag-react-container');\n\n        // DEPRECATED - use componentInstance.getReactContainerStyle or componentInstance.getReactContainerClasses instead\n        // so user can have access to the react container, to add css class or style\n        params.reactContainer = eParentElement;\n\n        return eParentElement;\n    }\n\n    public statelessComponentRendered(): boolean {\n        // fixed fragmentsFuncRendererCreateDestroy funcRendererWithNan (changeDetectionService too for NaN)\n        return this.eParentElement.childElementCount > 0 || this.eParentElement.childNodes.length > 0;\n    }\n\n    private static hasSymbol() {\n        return typeof Symbol === 'function' && Symbol.for;\n    }\n\n    private static isStateless(Component: any) {\n        return (typeof Component === 'function' && !(Component.prototype && Component.prototype.isReactComponent))\n            || (typeof Component === 'object' && Component.$$typeof === ReactComponent.REACT_MEMO_TYPE);\n    }\n\n    public isNullRender(): boolean {\n        return this.staticMarkup === \"\";\n    }\n\n    /*\n     * Attempt to render the component as static markup if possible\n     * What this does is eliminate any visible flicker for the user in the scenario where a component is destroyed and\n     * recreated with exactly the same data (ie with force refresh)\n     * Note: Some use cases will throw an error (ie when using Context) so if an error occurs just ignore it any move on\n     */\n    private renderStaticMarkup(params: any) {\n        if (this.parentComponent.isDisableStaticMarkup() || !this.componentType.isCellRenderer()) {\n            return;\n        }\n\n        const reactComponent = React.createElement(this.reactComponent, params);\n        try {\n            const staticMarkup = renderToStaticMarkup(reactComponent);\n            // if the render method returns null the result will be an empty string\n            if (staticMarkup === \"\") {\n                this.staticMarkup = staticMarkup;\n            } else {\n                if (staticMarkup) {\n                    // we wrap the content as if there is \"trailing\" text etc it's not easy to safely remove\n                    // the same is true for memoized renderers, renderers that that return simple strings or NaN etc\n                    this.staticMarkup = document.createElement('span');\n                    this.staticMarkup.innerHTML = staticMarkup;\n                    this.eParentElement.appendChild(this.staticMarkup);\n                }\n            }\n        } catch (e) {\n            // we tried - this can happen with certain (rare) edge cases\n        }\n    }\n\n    private removeStaticMarkup() {\n        if (this.parentComponent.isDisableStaticMarkup() || !this.componentType.isCellRenderer()) {\n            return;\n        }\n\n        if (this.staticMarkup && (this.staticMarkup as HTMLElement).remove) {\n            (this.staticMarkup as HTMLElement).remove();\n            this.staticMarkup = null;\n        }\n    }\n\n    rendered() {\n        return this.isNullRender() ||\n            this.staticMarkup ||\n            (this.isStatelessComponent() && this.statelessComponentRendered()) ||\n            (!this.isStatelessComponent() && this.getFrameworkComponentInstance());\n    }\n}\n"]}